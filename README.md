# GAcustomerprediction (스파르타코딩클럽_심화프로젝트)

### 개요
---
- 유저 분석에 널리 사용되는 GA4 데이터를 직접 다뤄봅니다
- 서비스 사용성 분석에 일반적으로 사용되는 지표를 직접 구해봅니다

### 배경
---
- 로그 데이터 Log data는 서비스를 이용하는 유저의 족적을 파악할 수 있는 데이터입니다.
- 굉장히 양이 많고, 전처리가 조금 어렵지만 서비스 분석을 하기 위해서는 필수적인 여정이기에 이를 체험보고자 합니다.

### 주제
---
- 사용자 로그 행동 데이터 활용 웹 서비스 분석

### 설명
---
- 파이썬을 이용해 주어진 데이터로부터 다음의 지표들을 구하고 시각화합니다.
    - DAU/WAU/MAU를 line chart로 시각화
    - 유저별 평균접속시간의 분포를 ECDF로 시각화
    - 방문 주차에 따른 코호트를 생성하고, 코호트 별로 weekly 리텐션을 구하고 이를 heatmap으로 시각화
    - 요일/시간대별 사용자 수를 구하고 이를 heatmap으로 시각화
    - (Challenging) Carrying Capacity
        - [참고 영상(토스)](https://www.youtube.com/watch?v=tcrr2QiXt9M&t=1s)
    - (Challenging) 국가별 DAU 평균을 Folium으로 시각화하기
    - (Challenging) 캠페인 효과 분석: 캠페인으로 들어온 사람은 다른 사람과 다른 특징을 가지고 있는지 분석해보기
    
### 데이터 
---
- [(Kaggle 데이터)Google Analytics Customer Revenue Prediction](https://www.kaggle.com/competitions/ga-customer-revenue-prediction/overview)


1.  처음 데이터를 받아서 아주 기본적인 전처리를 해보았음
    (json이 였던 데이터를 각각의 컬럼들로 펼치고, 데이터 형식을 바꾸는 작업 등)

2.  전처리한 데이터의 컬럼들이 각각 어떤 의미를 가지는지 해석하지는 시간을 가짐

3.  컬럼들을 해석해본 결과, transactionRevenue 라는 컬럼에 각 세션에서의 구매 활동과
    그로부터 각 얼마의 수익이 발생했는지가 나타나있다는 것을 알게되었음

4.  우리는 사전 조사를 통해,
    이 GA4 데이터가 google merchandise shop 이라는 온라인 쇼핑 사이트의 데이터라는 것을 알고 있었기 때문에

    각각의 구매 활동이 나타난 transactionRevenue 라는 항목을 예측하고 싶은 y값으로 설정하여
    이 transactionRevenue 값이 0을 초과하는, 즉 접속 세션으로 수익이 발생할 확률을 높이는 변수가 무엇인지
    로그 데이터(totals) 를 통해 알아보고자 했음

5.  이 때, aha 모먼트에 대한 것을 알게되었고 앞의 개념을 좀더 구체화하여
    각 고객이 특정 기간동안 어떤 액션을 몇번 이상 취해야, 
    그 고객으로부터 수익이 발생할 확률이 95% 이상이 되는지를 알아내고자 했고 그것을 분석의 목표로 잡았음

6.  이후 분석을 통하여, 한 고객이 한주에 대략 43번 이상의 새로운 페이지 조회 활동(pageviews) 을 하면
    그 고객으로부터 수익이 발생할 확률이 95%에 수렴한다는 것을 알게 되었음

7.  하지만 실질적으로 이것은 실패한 분석이 되었음
    왜냐하면 데이터에 나타난 70만명이 넘는 전체 고객의 수 중, 이러한 액션을 취한 고객의 수가 300명이 채 안되며
    극단적으로 작았기 때문에,
    이러한 액션과 수익이 발생할 확률 간에 인과 관계를 갖는다고 보기가 어려웠고 아하 모먼트라고 볼 수가 없었음

8.  다른 지표에 대해서도 아하모먼트를 찾으려고 노력을 해보았으나, 기본적으로 전체 데이터중 수익이 발생한
    접속 세션 자체가 굉장히 적었고, 또 다른 변수들과도 뚜렷한 상관 관계가 있는 것을 찾아볼 수 없었기 때문에
    더이상의 아하모먼트를 찾으려는 시도는 크게 의미가 있을꺼 같지 않아보였음

9.  이후에 다른 인사이트를 만들 수 있는 분석 방향성을 찾아보고자, 회의를 더 진행

    그 결과로 1.수익이 발생한 유저 집단과 그렇지 않은 유저 집단을 나누어서 세그멘테이션을 진행하자,
    2.수익이 몇번 이상 발생한 유저들을 retain 된 유저라고 볼수 있는가 등등 여러 아이디어들이 나왔으나

    인사이트를 도출하기까지, 지표 자체는 탐색이 가능하나 앞선 시도에서와 비슷한 문제들이 발생할 것이라고
    보였기 때문에

    먼저 과제에 마련되어 있는 가이드 라인에 따른 분석을 좀더 면밀히 진행해보고, 분석 결과에 따라
    이후 방향성을 다시 잡아보고 가능하다면 problem targeting 을 해보는 것으로 결정됨

10. 가이드 라인 분석 결과 설명 -- DAU, WAU, MAU 시각화 / 요일, 시간대 별 방문자 수 히트맵 / 
                                접속 시간 ECDF (접속 지속 시간이 0인 데이터가 굉장히 많았음을 알수 있었음 
                                == 유저 이탈률 : bounce rate)

11. 그리고 방문 주차별 리텐션 히트맵을 만들때, 1년 전체의 히트맵을 만드는 것에는 무리가 있다고 생각

    WAU 그래프에서 가장 많은 접속이 있었던 2016년 11월 1일부터 12월 12일까지 총 6주간의 데이터를 샘플링하기로 결정

    히트맵을 만들어본 후, 처음 사이트에 접속한 유저들 중 대부분이(97% 이상)이 바로 다음주부터 이탈하는 현상을 파악

    접속자 수가 굉장히 높은 구간의 데이터를 샘플링했기 때문에  
    이 기간 동안에 무언가 외부적인 요인에 의한 평소보다 훨씬 많은 양의 inflow 가 있었고,
    이때 갑자기 늘어난 접속자의 수가 사이트의 carrying capacity 를 훨씬 상회하는 것이였기 때문에
    이렇게 높은 이탈률이 나타난 것이 아닐까 하는 추측을 하게됨

    **(이 외부적 요인이 campaign 의 실시일수도 있고, 다른 어떤 이벤트가 있었을 가능성도 있음)
       그러나 컬럼중에 campaign 에 관련된 컬럼이 있기는 하지만 언제 실시되었는가에 대한 데이터는 아니기 떄문에
       제대로 확인하는 것은 불가능함 

       간략하게나마 알아보고자 구글링을 통해, 이 시기에 구글 샵에서 어떠한 이벤트나 프로모션이 있었는가를 알아보았지만
       특별한 것은 없었음.
       아마 높은 확률로 이 시기에 있는 기념일인 크리스마스에 의한 특수가 아닐까 생각함

12. 앞에서 추측한 내용을 확인하기 위해서는 샘플링한 데이터의 이탈률 외에 
    평균적인 접속자 수를 지니고 있는 기간의 데이터도 이탈률도 히트맵으로 알아볼 필요가 있음을 알게됨

    WAU 기준, 일반적인 때의 접속자 수를 가지고 있는 기간을 대표하는 샘플로서
    2017년 4월 1일 부터 5월 12일까지 6주 동안의 데이터가 적합하다고 판단하였음

13. 실제로 새로운 기간의 데이터를 히트맵으로 그려본 결과,
    유저의 접속이 굉장히 많았던 2016년 11월 ~ 12월과 반하여 0주차의 접속자 수는 절반 정도로 줄었지만

    5주차에 남아있는 유저들의 수는 100명 ~ 150명 정도로 큰 차이가 존재하지 않는 것을 확인할 수 있다

14. 이를 통해 carrying capacity 와 관련된 분석을 진행할 수 있을 것 같다 --

15. 하지만 GA4 데이터의 출처가 google merchan. shop 으로 일종의 기념품 굿즈 등을 판매하는 샵이기 때문에,
    다른 지속적인 서비스 제공에 핵심 가치가 존재하는 일반적인 쇼핑몰 사이트들과는 다르게

    사이트 자체가 굉장히 1회성이라는 점에 주목을 할 필요가 있다.

    일반적인 고객들 중에 이런 기념품 샵에서 주기적인 구매 활동을 할 고객이 얼마나 되겠는가?
    거의 없다고 봐도 무방하다

    이러한 특성은 방문 0주차에 대비해 1, 2 ,3, 4, 5 주차에 가면서 남아있는 고객들(즉 다시 접속하거나 구매활동을 하는 유저)가
    거의 없다는 점에서 확실하게 드러난다 (구매한 유저들 중 실제로 1주차에 다시 구매 활동을 한 유저들이 1%도 안된다)

16. 이말인 즉슨, 이 google merchan. shop 의 유저 이탈률에 관한 문제는
    사이트에서 고객들이 지속적인 구매 활동을 할수 있을만한 상품들의 추가 및 교체 등을 포함한
    사이트의 전체적인 구조 개편이 없으면 사실상 해결이 불가능한 문제라는 것이다.

17. 그럼에도 불구하고, google merchan. shop 의 전체적인 수익을 개선하고 싶다면 어떤 방식을 취할 수 있을까?

18. 유저의 지속적인 구매활동을 늘리는 것을 포기하는 대신,
    바로 크리스마스 등 선물을 주고 받는 특정 시즌에 대한 매출을 폭발적으로 늘리는 것에 집중하는 것이다
    
    이른바 한철 장사라고 불리는 것을 굉장히 효율적으로 진행하자는 것이다.
    구체적인 방안 제시로는

    1. 크리스마스와 같은 다른 선물을 자주 하는 특수 시즌에도 많은 접속자 수를 끌어들일 수 있도록 광고 진행
       (추수 감사절이나 졸업 시즌, 발렌타인 데이 등과 같은 시즌들)
    2. 이 특수 시즌 안에 최대한 많은 구매가 이루어질 수 있도록 프로모션 등을 적극적으로 장려
    3. 적어도 재구매가 어느정도 발생했던 1주차에 대하여 다시 구매하는 빈도수를 높이기 위하여
       구매 후 일주일 안쪽으로 재구매할 때, 사용할 수 있는 쿠폰의 지급, 푸시 알림 등을 발송할 수 있을 것